---
instance_groups:
- name: haproxy
  vm_extensions:
  - (( append ))
  - cf-elb
  jobs:
  - { name: consul_agent,   release: consul, consumes: { consul: { from: consul_server } } }
  - { name: haproxy,        release: haproxy }
  - { name: metron_agent,   release: loggregator }
- name: router
  vm_extensions: []

properties:
  ha_proxy:
    backend_servers: (( grab instance_groups.router.networks[0].static_ips ))
    internal_only_domains: (( grab params.internal_only_domains ))
    trusted_domain_cidrs: (( grab params.trusted_domain_cidrs ))
    ssl_pem: ~

    tcp:
    - name: ssh-proxy
      port: 2222
      ssl: false
      backend_servers: (( grab instance_groups.access.networks[0].static_ips ))
      backend_port: 2222

releases:
- name: haproxy
  version: 8.0.12
  sha1: 17d850ff3bbf46d78b507eae9f6737740f9fa675
  url: https://github.com/cloudfoundry-community/haproxy-boshrelease/releases/download/v8.0.12/haproxy-8.0.12.tgz

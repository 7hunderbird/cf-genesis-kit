---
instance_groups:
- name: access
  jobs:
  - { name: consul_agent,   release: consul, consumes: { consul: { from: consul_server }}}
  - { name: ssh_proxy,      release: diego }
  - { name: metron_agent,   release: loggregator }
  - { name: file_server,    release: diego }
  - { name: cfdot,          release: diego }
  - { name: toolbelt,       release: toolbelt }
  - { name: toolbelt-quick, release: toolbelt }

properties:
  app_ssh:
    host_key_fingerprint: (( vault meta.vault "/ssh_proxy/host_key:fingerprint" ))
    oauth_client_id: ssh-proxy
  diego:
    ssh_proxy:
      bbs: (( grab meta.bbs ))
      enable_cf_auth: true
      host_key: (( vault meta.vault "/ssh_proxy/host_key:private" ))
      uaa_secret: (( grab meta.uaa.ssh_proxy_secret ))
      uaa:
        url: (( grab properties.uaa.url ))
        port: (( grab properties.uaa.port
        ca_cert: (( vault meta.vault "/uaa/certs/ca:certificate" ))

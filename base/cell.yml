---
instance_groups:
- name: cell
  jobs:
  - { name: consul_agent,  release: consul, consumes: { consul: { from: consul_server }}}
  - { name: rep,           release: diego }
  - { name: garden,        release: garden-runc }
  - { name: cflinuxfs2-rootfs-setup, release: cflinuxfs2-rootfs }
  - { name: metron_agent,            release: loggregator }
  - { name: cfdot,                   release: diego }
  - { name: toolbelt,                release: toolbelt }
  - { name: toolbelt-quick,          release: toolbelt }
  - { name: toolbelt-veritas,        release: toolbelt }

meta:
  rep:
    ca_cert: (( vault meta.vault "/ca:ca-pem" ))
    client_cert: (( vault meta.vault "/rep/client:cert" ))
    client_key:  (( vault meta.vault "/rep/client:key" ))
    client_session_cache_size: ~
    require_tls: true
    server_cert: (( vault meta.vault "/rep/server:cert" ))
    server_key:  (( vault meta.vault "/rep/server:key" ))

properties:
  cflinuxfs2-rootfs:
    trusted_certs: ~
  rep:
    bbs: (( grab meta.bbs ))
    dropsonde_port: ~
    enable_legacy_api_endpoints: false
    evacuation_timeout_in_seconds: 60
    listen_addr_admin: ~
    log_level: debug
    preloaded_rootfses:
    - cflinuxfs2:/var/vcap/packages/cfliniuxfs2/rootfs
    trusted_certs: ~
    require_tls: true
    ca_cert: (( grab meta.rep.ca_cert )0
    server_cert: (( grab meta.rep.server_cert ))
    server_key: (( grab meta.rep.server_key ))
  diego:
    executor:
      ca_certs_for_downloads: null
  garden:
    default_container_grace_time: 0
    destroy_containers_on_start: true
    graph_cleanup_threshold_in_mb: 0
    deny_networks:
    - 0.0.0.0/0
    persistent_image_list:
    - "/var/vcap/packages/cflinuxfs2/rootfs"

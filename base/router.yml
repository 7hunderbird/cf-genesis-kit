---
instance_groups:
- name: router
  jobs:
  - { name: consul_agent,   release: consul, consumes: { consul: { from: consul_server }}}
  - { name: gorouter,       release: routing }
  - { name: toolbelt,       release: toolbelt }
  - { name: toolbelt-quick, release: toolbelt }
  properties:
    consul:
      agent:
        services:
          gorouter: {}

properties:
  router:
    enable_ssl: false
    route_services_secret: ((( vault meta.vault "/gorouter/route_services:secret" ))
    ssl_cert: ~
    ssl_key: ~
    ssl_skip_validation: (( grab params.skip_ssl_validation ))
    status:
      user: health
      password: (( vault meta.vault "/gorouter/status:password" ))
